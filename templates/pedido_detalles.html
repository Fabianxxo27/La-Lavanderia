{% extends "base.html" %}
{% block title %}Pedido {{ pedido[0] }}{% endblock %}

{% block content %}
<h3>Pedido #{{ pedido[0] }}</h3>
<p><strong>Cliente:</strong> {{ cliente_nombre }}</p>
<p><strong>Fecha ingreso:</strong> {{ pedido[1] }}</p>
<p><strong>Fecha entrega:</strong> {{ pedido[2] or '---' }}</p>
<p><strong>Estado:</strong> {{ pedido[3] }}</p>

<hr>
<h5>Prendas</h5>
<table class="table">
  <thead><tr><th>ID</th><th>Tipo</th><th>Descripcion</th><th>Observaciones</th></tr></thead>
  <tbody>
    {% for pr in prendas %}
    <tr>
      <td>{{ pr[0] }}</td>
      <td>{{ pr[1] }}</td>
      <td>{{ pr[2] }}</td>
      <td>{{ pr[3] }}</td>
    </tr>
    {% else %}
    <tr><td colspan="4">No hay prendas.</td></tr>
    {% endfor %}
  </tbody>
</table>

<h5>Agregar prenda</h5>
<form method="post" action="{{ url_for('agregar_prenda', id_pedido=pedido[0]) }}">
  <div class="mb-3">
    <label class="form-label">Tipo</label>
    <input class="form-control" name="tipo" required>
  </div>
  <div class="mb-3">
    <label class="form-label">Descripci√≥n</label>
    <input class="form-control" name="descripcion">
  </div>
  <div class="mb-3">
    <label class="form-label">Observaciones</label>
    <input class="form-control" name="observaciones">
  </div>
  <button class="btn btn-primary">Agregar prenda</button>
</form>

{% if session.get('rol') and session.get('rol')|lower in ['administrador','admin'] %}
  <form method="post" action="{{ url_for('actualizar_pedido', id_pedido=pedido[0]) }}" class="mt-3">
    <label class="form-label">Cambiar estado (administrador)</label>
    <select name="estado" class="form-select mb-2">
      <option value="Pendiente" {% if pedido[3] == 'Pendiente' %}selected{% endif %}>Pendiente</option>
      <option value="En proceso" {% if pedido[3] == 'En proceso' %}selected{% endif %}>En proceso</option>
      <option value="Completado" {% if pedido[3] == 'Completado' %}selected{% endif %}>Completado</option>
      <option value="Cancelado" {% if pedido[3] == 'Cancelado' %}selected{% endif %}>Cancelado</option>
    </select>
    <button class="btn btn-primary">Actualizar estado</button>
  </form>
{% endif %}

<div class="mt-3">
  <button class="btn btn-secondary" onclick="history.back()">Volver</button>
  <a href="{{ url_for('pedidos') if session.get('rol') and session.get('rol')|lower in ['administrador','admin'] else url_for('cliente_pedidos') }}" class="btn btn-outline-secondary">Volver a la lista</a>
</div>
{% endblock %}
